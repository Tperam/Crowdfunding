{"ast":null,"code":"var _jsxFileName = \"/home/tperam/code/crowdfunding/src/Component/projectList.js\";\nimport React from 'react';\nimport { Card, Button, Row, Col, ProgressBar } from 'react-bootstrap';\nimport { Link } from 'react-router-dom';\nimport web3 from '../libs/web3';\nimport ProjectListContract from '../libs/projectList';\nimport getProjectContract from '../libs/project';\n\nclass ProjectList extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      projects: []\n    };\n    window.testWeb3 = web3;\n  }\n\n  async componentWillMount() {\n    // 获取所有众筹项目的地址\n    const addresses = await ProjectListContract.methods.getProjectList().call(); // 获取projectInfoList\n\n    const projectList = await Promise.all(addresses.map(address => getProjectContract(address).methods.getGeneralInfo().call()));\n    const investorNum = await Promise.all(addresses.map(address => getProjectContract(address).methods.getInvestNum().call()));\n    let projects = projectList.map((obj, index) => {\n      let [projectName, goal, maxInvest, minInvest, description, symbol, bonusEnds, balance] = Object.values(obj);\n      return {\n        projectName: web3.utils.toUtf8(projectName),\n        goal: web3.utils.fromWei(goal),\n        maxInvest: web3.utils.fromWei(maxInvest),\n        minInvest: web3.utils.fromWei(minInvest),\n        description,\n        symbol: web3.utils.toUtf8(symbol),\n        bonusEnds,\n        balance: investorNum[index][0],\n        address: addresses[index]\n      };\n    });\n    this.setState({\n      projects: projects\n    });\n  }\n\n  render() {\n    let projectListInfo = this.state.projects.map((project, index) => {\n      let flagBonusTime = project.bonusEnds > Date.parse(new Date()) / 1000;\n      console.log(project);\n      let precentComplete = (project.balance / project.goal).toFixed(2);\n      return /*#__PURE__*/React.createElement(Card, {\n        className: (flagBonusTime ? \"goldStyle\" : \"\", \"mt20\"),\n        key: index,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 62,\n          columnNumber: 8\n        }\n      }, /*#__PURE__*/React.createElement(Card.Header, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 6\n        }\n      }, \" \", project.projectName, \" \"), /*#__PURE__*/React.createElement(Card.Body, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 64,\n          columnNumber: 6\n        }\n      }, /*#__PURE__*/React.createElement(ProgressBar, {\n        animated: true,\n        now: precentComplete,\n        label: precentComplete + \"%\",\n        className: \"mb20\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 65,\n          columnNumber: 7\n        }\n      }), /*#__PURE__*/React.createElement(Card.Title, {\n        className: \"textHidden\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 7\n        }\n      }, project.description), /*#__PURE__*/React.createElement(Card.Text, {\n        as: Row,\n        className: \"mb20\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 8\n        }\n      }, \"goal: \", /*#__PURE__*/React.createElement(\"span\", {\n        className: \"red\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 19\n        }\n      }, project.goal), \" eth\"), /*#__PURE__*/React.createElement(Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 8\n        }\n      }, \"maxInvest: \", /*#__PURE__*/React.createElement(\"span\", {\n        className: \"red\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 24\n        }\n      }, project.maxInvest), \" eth\"), /*#__PURE__*/React.createElement(Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 8\n        }\n      }, \"minInvest: \", /*#__PURE__*/React.createElement(\"span\", {\n        className: \"red\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 70,\n          columnNumber: 24\n        }\n      }, project.minInvest), \" eth\"), /*#__PURE__*/React.createElement(Col, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 8\n        }\n      }, \"\\u4F17\\u7B79\\u5B8C\\u6210\\u5EA6: \", /*#__PURE__*/React.createElement(\"span\", {\n        className: \"red\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 20\n        }\n      }, precentComplete, \"%\"))), /*#__PURE__*/React.createElement(Row, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 10\n        }\n      }, /*#__PURE__*/React.createElement(Col, {\n        md: {\n          span: 3,\n          offset: 3\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 8\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        as: Link,\n        to: \"/projectDetail/\" + project.address,\n        variant: flagBonusTime ? \"warning\" : \"success\",\n        size: \"sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 41\n        }\n      }, \"Learn more\")))));\n    });\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 5\n      }\n    }, \"\\u4F17\\u7B79\\u5217\\u8868\"), projectListInfo);\n  }\n\n}\n\nexport default ProjectList;","map":{"version":3,"sources":["/home/tperam/code/crowdfunding/src/Component/projectList.js"],"names":["React","Card","Button","Row","Col","ProgressBar","Link","web3","ProjectListContract","getProjectContract","ProjectList","Component","constructor","props","state","projects","window","testWeb3","componentWillMount","addresses","methods","getProjectList","call","projectList","Promise","all","map","address","getGeneralInfo","investorNum","getInvestNum","obj","index","projectName","goal","maxInvest","minInvest","description","symbol","bonusEnds","balance","Object","values","utils","toUtf8","fromWei","setState","render","projectListInfo","project","flagBonusTime","Date","parse","console","log","precentComplete","toFixed","span","offset"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Card, Button, Row, Col, ProgressBar } from 'react-bootstrap';\nimport { Link } from 'react-router-dom';\nimport web3 from  '../libs/web3';\nimport ProjectListContract from '../libs/projectList';\nimport getProjectContract from '../libs/project';\n\nclass ProjectList extends React.Component{\n\n\tconstructor( props){\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tprojects:[]\n\t\t}\n\t\twindow.testWeb3 = web3\n\t}\n\n\tasync componentWillMount(){\n\t\t// 获取所有众筹项目的地址\n    \tconst addresses = await ProjectListContract.methods.getProjectList().call();\n    \t// 获取projectInfoList\n    \tconst projectList = await Promise.all(addresses.map(address=> getProjectContract(address).methods.getGeneralInfo().call() ));\n    \tconst investorNum = await Promise.all(addresses.map(address=> getProjectContract(address).methods.getInvestNum().call() ));\n\n    \tlet projects = projectList.map( (obj,index)=>{\n\n    \t\tlet [\n\t\t\t\tprojectName,\n\t\t\t\tgoal,\n\t\t\t\tmaxInvest,\n\t\t\t\tminInvest,\n\t\t\t\tdescription,\n\t\t\t\tsymbol,\n\t\t\t\tbonusEnds,\n\t\t\t\tbalance\n    \t\t]=Object.values(obj);\n\n    \t\treturn {\n    \t\t\tprojectName: web3.utils.toUtf8(projectName),\n\t\t\t\tgoal: web3.utils.fromWei(goal),\n\t\t\t\tmaxInvest: web3.utils.fromWei(maxInvest),\n\t\t\t\tminInvest: web3.utils.fromWei(minInvest),\n\t\t\t\tdescription,\n\t\t\t\tsymbol: web3.utils.toUtf8(symbol),\n\t\t\t\tbonusEnds,\n\t\t\t\tbalance: investorNum[index][0],\n\t\t\t\taddress:addresses[index]\n\t\t\t}\n    \t} )\n\n    \tthis.setState({\n    \t\tprojects:projects\n    \t})\n\t}\n\n\trender(){\n\t\tlet projectListInfo = this.state.projects.map( (project,index)=>{\n\t\t\tlet flagBonusTime = project.bonusEnds > Date.parse(new Date())/1000;\n\t\t\tconsole.log(project)\n\t\t\tlet precentComplete = (project.balance / project.goal).toFixed(2);\n\t\t\treturn (\n\t    \t\t<Card className={flagBonusTime ? \"goldStyle\" : \"\",\"mt20\"} key={index}>\n\t\t\t\t\t<Card.Header> {project.projectName} </Card.Header>\n\t\t\t\t\t<Card.Body >\n\t\t\t\t\t\t<ProgressBar animated now={precentComplete}  label={precentComplete+\"%\"} className=\"mb20\"/>\n\t\t\t\t\t\t<Card.Title className=\"textHidden\">{project.description}</Card.Title>\n\t\t\t\t\t\t<Card.Text as={Row} className=\"mb20\">\n\t\t\t\t\t\t\t<Col>goal: <span className={\"red\"}>{project.goal}</span> eth</Col>\n\t\t\t\t\t\t\t<Col>maxInvest: <span className={\"red\"}>{project.maxInvest}</span> eth</Col>\n\t\t\t\t\t\t\t<Col>minInvest: <span className={\"red\"}>{project.minInvest}</span> eth</Col>\n\t\t\t\t\t\t\t<Col>众筹完成度: <span className={\"red\"}>{precentComplete}%</span></Col>\n\t\t\t\t\t    </Card.Text>\n\t\t\t\t\t    <Row>\n\t\t\t\t\t\t\t<Col md={{ span: 3, offset: 3 }}><Button as={Link} to={\"/projectDetail/\"+project.address} variant={flagBonusTime?\"warning\":\"success\"} size=\"sm\">Learn more</Button></Col>\n\t\t\t\t\t\t</Row>\n\t\t\t\t\t</Card.Body>\n\t\t\t\t</Card>\n\t\t\t)\n\t\t})\n\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<h1>众筹列表</h1>\n\t\t\t\t{ projectListInfo }\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default ProjectList;"]},"metadata":{},"sourceType":"module"}